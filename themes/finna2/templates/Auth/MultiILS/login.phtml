<!-- START of: finna - Auth/MultiILS/login.phtml -->
<? $account = $this->auth()->getManager(); ?>
<? $sessionInitiator = $account->getSessionInitiator($this->serverUrl($this->url('myresearch-home'))); ?>
<? if (!$sessionInitiator): // display default login form if no login URL provided ?>
<div>
  <form method="post" class="form-vertical" action="<?=$this->url('myresearch-home')?>" name="loginForm" id="loginForm">
    <?=$this->auth()->getLoginFields()?>
    <input type="hidden" name="auth_method" value="<?=$account->getAuthMethod()?>">
    <input type="hidden" name="csrf" value="<?=$this->escapeHtmlAttr($account->getCsrfHash(true))?>" />
    <div class="clearfix"></div>
    <div class="form-group">
        <? if ($account->supportsCreation()): ?>
          <a class="btn btn-link createAccountLink" href="<?=$this->url('myresearch-account') ?>?auth_method=<?=$account->getAuthMethod()?>"><?=$this->transEsc('Create New Account')?></a>
        <? endif; ?>
        <input class="btn btn-primary" type="submit" name="processLogin" value="<?=$this->transEsc('Login')?>">
        <? if ($account->supportsRecovery()): ?>
          <br/>
          <a class="btn btn-link" href="<?=$this->url('myresearch-recover') ?>?auth_method=<?=$account->getAuthMethod()?>"><?=$this->transEsc('Forgot Password')?></a>
        <? endif; ?>
        <a id="login_library_card_recovery" class="btn btn-link" href="<?=$this->url('librarycards-recover') ?>"><?=$this->transEsc('Forgot Password')?></a>
    </div>
  </form>
</div>
<div>
  <div class="login-col visible-xs">
    <div class="login-description">
      <p class="login-info">
        <?=$this->translate('login_desc_library_card_html') ?>
      </p>
    </div>
  </div>
</div>
<? else: ?>
  <a href="<?=$this->escapeHtmlAttr($sessionInitiator)?>" data-lightbox-ignore><?=$this->transEsc("Institutional Login")?></a>
<? endif; ?>

<?
  $recovery = [];
  foreach ($this->auth()->getManager()->getLoginTargets() as $target) {
    $recovery[$target] = $this->auth()->getManager()->ilsSupportsPasswordRecovery($target)
      ? $this->url('librarycards-recover') . "?target=$target" : false;
  }

  $recovery = json_encode($recovery);
  $script = <<<EOT
  finna.layout.initILSPasswordRecoveryLink($recovery);
EOT;

  // Inline the script for lightbox compatibility
  echo $this->inlineScript(\Zend\View\Helper\HeadScript::SCRIPT, $script, 'SET');
?>
<!-- END of: finna - Auth/MultiILS/login.phtml -->
